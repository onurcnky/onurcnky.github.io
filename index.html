<!DOCTYPE html>
<html>
<head>
	<title>My SCORM Player</title>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
	<script src="SCORM_API_wrapper.js" type="text/javascript"></script>
	<script>
		var scormPlayerWindow;
		var scormPlayerUrl = "scorm2004.html?imsmanifest=imsmanifest.xml";

		var scormAPI = pipwerks.SCORM;
		var scormConnected = false;

		function launchScormPlayer() {
			if (scormPlayerWindow && !scormPlayerWindow.closed) {
				scormPlayerWindow.close();
			}
			scormPlayerWindow = window.open(scormPlayerUrl);
			initSCORM();
		}

		function initSCORM() {
			if (!scormConnected) {
				var connectResult = scormAPI.doLMSInitialize();
				if (connectResult) {
					scormConnected = true;
				} else {
					alert("Failed to connect to LMS");
				}
			}
		}

		function closeScormPlayer() {
			if (scormConnected) {
				scormAPI.doLMSFinish();
				scormConnected = false;
			}
			if (scormPlayerWindow && !scormPlayerWindow.closed) {
				scormPlayerWindow.close();
			}
		}

		$(function() {
			$("#play-button").click(launchScormPlayer);
			$("#close-button").click(closeScormPlayer);
			
			function initCourse(){

   //scorm.init returns a boolean
   lmsConnected = scorm.init();

   //If the scorm.init function succeeded...
   if(lmsConnected){

      //Let's get the completion status to see if the course has already been completed
      var completionstatus = scorm.get("cmi.core.lesson_status");

      //If the course has already been completed...
      if(completionstatus == "completed" || completionstatus == "passed"){

         //...let's display a message and close the browser window
         handleError("You have already completed this course. You do not need to continue.");

      }

      //Now let's get the username from the LMS
      var learnername = scorm.get("cmi.core.student_name");

      //If the name was successfully retrieved...
      if(learnername){  

         //...let's display the username in a page element named "learnername"
         document.getElementById("learnername").innerHTML = learnername; //use the name in the form

      }

   //If the course couldn't connect to the LMS for some reason...
   } else {

      //... let's alert the user then close the window.
      handleError("Error: Course could not connect with the LMS");

 
		});
	</script>
</head>
<body>
	<button id="play-button">Play SCORM</button>
	<button id="close-button">Close SCORM Player</button>
	
	
</body>
</html>
